{
  "root": {
    "type": "Bt/Parallel",
    "config": { "exitCondition": "AllSuccess" },
    "children": [
      { "$ref": "#PhaseControl" },
      {
        "type": "Bt/SwitchByBlackboard",
        "config": {
          "field": "BehaviorMode",
          "routes": {
            "Aggressive": { "$ref": "#CombatLoop" },
            "Reactive": { "$ref": "#ReactiveTriggers" },
            "Mocking": { "$ref": "#TauntHandler" }
          }
        }
      }
    ]
  },

  "PhaseControl": {
    "type": "Bt/Condition",
    "config": {
      "label": "FinalPhaseTrigger",
      "check": { "type": "HealthBelow", "value": 10 }
    },
    "child": {
      "type": "Bt/Sequence",
      "children": [
        {
          "type": "Bt/PlayAnimation",
          "config": {
            "animation": "phase_transition",
            "layer": "UpperBody"
          }
        },
        {
          "type": "Bt/PlayFX",
          "config": {
            "fx": "fx.phaseChange",
            "attachTo": "root"
          }
        },
        {
          "type": "Bt/Taunt",
          "config": {
            "lines": ["My final form is... disappointment."],
            "voice": "vo.finalForm"
          }
        },
        {
          "type": "Bt/ExecuteSkill",
          "config": {
            "skill": "teleport",
            "cooldownKey": "teleport",
            "fx": "fx.teleport",
            "animation": "anim.teleport"
          }
        },
        {
          "type": "Bt/Loop",
          "config": { "count": 3 },
          "child": {
            "type": "Bt/Sequence",
            "children": [
              {
                "type": "Bt/ExecuteSkill",
                "config": {
                  "skill": "smash",
                  "cooldownKey": "smash",
                  "animation": "anim.smash",
                  "fx": "fx.smash",
                  "telegraph": "telegraph.smash"
                }
              },
              {
                "type": "Bt/TimeoutDecorator",
                "config": { "duration": 0.75 }
              }
            ]
          }
        },
        {
          "type": "Bt/Taunt",
          "config": {
            "lines": ["You still here?"],
            "voice": "vo.disappointed"
          }
        }
      ]
    }
  },

  "CombatLoop": {
    "type": "Bt/Repeater",
    "child": {
      "type": "Bt/Sequence",
      "children": [
        {
          "type": "Bt/Parallel",
          "config": { "exitCondition": "AnyFailure" },
          "children": [
            {
              "type": "Bt/Selector",
              "children": [
                {
                  "type": "Bt/Condition",
                  "config": {
                    "label": "StunLoopTrigger",
                    "check": { "type": "WasStunnedNTimes", "count": 2 }
                  },
                  "child": {
                    "type": "Bt/RepeatSkill",
                    "config": {
                      "skill": "smash",
                      "times": 4,
                      "interval": 0.5,
                      "cooldownKey": "smash",
                      "animation": "anim.smash",
                      "fx": "fx.smash",
                      "telegraph": "telegraph.smash"
                    }
                  }
                },
                {
                  "type": "Bt/ExecuteSkill",
                  "config": {
                    "skill": "dash",
                    "cooldownKey": "dash",
                    "fx": "fx.dash",
                    "animation": "anim.dash",
                    "telegraph": "telegraph.dash"
                  }
                },
                {
                  "type": "Bt/MoveToTarget",
                  "config": {
                    "$ref": "movement"
                  }
                }
              ]
            },
            {
              "type": "Bt/TimeoutDecorator",
              "config": { "duration": 1.25 }
            }
          ]
        }
      ]
    }
  },

  "ReactiveTriggers": {
    "type": "Bt/Sequence",
    "children": [
      {
        "type": "Bt/Condition",
        "config": {
          "label": "CornerTrapTrigger",
          "check": { "type": "PlayerInCorner" }
        },
        "child": {
          "type": "Bt/ExecuteSkill",
          "config": {
            "skill": "teleport",
            "cooldownKey": "teleport",
            "animation": "anim.teleport",
            "fx": "fx.teleport",
            "telegraph": "telegraph.teleport"
          }
        }
      }
    ]
  },

  "TauntHandler": {
    "type": "Bt/RandomSelector",
    "config": { "interval": 10 },
    "children": [
      {
        "type": "Bt/Taunt",
        "config": {
          "lines": { "$ref": "text.taunt" },
          "domains": ["Combat", "PlayerInput"],
          "select": "weighted",
          "voice": "vo.randomCombat"
        }
      },
      {
        "type": "Bt/ExecuteSkill",
        "config": {
          "skill": "lockdown",
          "cooldownKey": "lockdown",
          "animation": "anim.lockdown",
          "fx": "fx.lockdown",
          "telegraph": "telegraph.lockdown"
        }
      }
    ]
  }
}